<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="濬瑒房產生活平台 - 趣味小遊戲">
<title>遊戲大廳 - 濬瑒房產生活平台</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preload" href="https://cdn.tailwindcss.com" as="script">
<style>
:root {
  --grad-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --grad-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --grad-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --grad-warning: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
  --grad-danger: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  --grad-info: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  overflow-x: hidden;
}

/* 主題切換 */
.dark {
  --grad-primary: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  --grad-secondary: linear-gradient(135deg, #0f3460 0%, #533483 100%);
  --grad-success: linear-gradient(135deg, #0f4c75 0%, #3282b8 100%);
  --grad-warning: linear-gradient(135deg, #0f4c75 0%, #bbe1fa 100%);
  --grad-danger: linear-gradient(135deg, #2c1810 0%, #8b4513 100%);
  --grad-info: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
}

.dark body {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
}

/* 玻璃效果 */
.glass {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(16px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.dark .glass {
  background: rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* 遊戲卡片 */
.game-card {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  padding: 1rem;
  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.dark .game-card {
  background: rgba(30, 30, 30, 0.95);
  color: white;
}

.game-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.game-card:hover::before {
  left: 100%;
}

.game-card:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

/* 動畫 */
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-12px); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.03); }
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-6px); }
  60% { transform: translateY(-3px); }
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 8px rgba(102, 126, 234, 0.4); }
  50% { box-shadow: 0 0 16px rgba(102, 126, 234, 0.6), 0 0 24px rgba(102, 126, 234, 0.4); }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.float { animation: float 4s ease-in-out infinite; }
.pulse { animation: pulse 3s ease-in-out infinite; }
.rotate { animation: rotate 12s linear infinite; }
.bounce { animation: bounce 1.5s ease-in-out infinite; }
.glow { animation: glow 3s ease-in-out infinite; }
.slide-in { animation: slideInUp 0.6s ease-out; }
.fade-in { animation: fadeIn 0.8s ease-out; }

/* 遊戲圖標 */
.game-icon {
  font-size: 2.5rem;
  margin-bottom: 0.5rem;
  display: block;
}

/* 遊戲圖案按鈕 */
.game-icon-btn {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  padding: 0.75rem 0.5rem;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  text-align: center;
  min-height: 100px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.dark .game-icon-btn {
  background: rgba(30, 30, 30, 0.95);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.game-icon-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.game-icon-btn:hover::before {
  left: 100%;
}

.game-icon-btn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

.game-icon-emoji {
  font-size: 2rem;
  margin-bottom: 0.25rem;
  display: block;
}

.game-icon-title {
  font-size: 0.75rem;
  font-weight: 600;
  color: #333;
  margin-bottom: 0.25rem;
  line-height: 1.2;
}

.dark .game-icon-title {
  color: white;
}

.game-icon-score {
  font-size: 0.65rem;
  color: #666;
  opacity: 0.8;
}

.dark .game-icon-score {
  color: #ccc;
}

/* 分數顯示 */
.score-display {
  background: rgba(102, 126, 234, 0.1);
  border-radius: 8px;
  padding: 0.5rem;
  margin-bottom: 0.5rem;
}

.dark .score-display {
  background: rgba(102, 126, 234, 0.2);
}

/* 按鈕樣式 */
.btn-game {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12px;
  padding: 10px 20px;
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.btn-game:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(102, 126, 234, 0.25);
}

.btn-game:active {
  transform: translateY(0);
}

.btn-game::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn-game:hover::before {
  left: 100%;
}

/* 主題切換按鈕 */
#themeToggle {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
}

#themeToggle:hover {
  transform: scale(1.1);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

/* 返回按鈕 */
.back-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.back-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

/* 手機優化 */
.game-area {
  touch-action: manipulation;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* 觸控優化 */
.touch-manipulation {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* 防止手機上的雙擊縮放 */
.game-icon-btn {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* 遊戲按鈕觸控優化 */
.btn-game {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* 防止手機上的滾動 */
.game-modal {
  touch-action: none;
  overflow: hidden;
}

.game-modal-content {
  touch-action: manipulation;
  -webkit-overflow-scrolling: touch;
}

/* 響應式設計 */
@media (max-width: 1024px) {
  .container {
    padding-left: 0.75rem;
    padding-right: 0.75rem;
  }
  
  .game-card {
    padding: 0.875rem;
  }
  
  .game-icon {
    font-size: 2.25rem;
  }
  
  .game-icon-btn {
    min-height: 90px;
    padding: 0.625rem 0.375rem;
  }
  
  .game-icon-emoji {
    font-size: 1.75rem;
  }
  
  .game-icon-title {
    font-size: 0.7rem;
  }
  
  .game-icon-score {
    font-size: 0.6rem;
  }
}

@media (max-width: 768px) {
  .game-card {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
  }
  
  .game-icon {
    font-size: 2rem;
  }
  
  .game-icon-btn {
    min-height: 85px;
    padding: 0.5rem 0.25rem;
  }
  
  .game-icon-emoji {
    font-size: 1.5rem;
  }
  
  .game-icon-title {
    font-size: 0.65rem;
  }
  
  .game-icon-score {
    font-size: 0.55rem;
  }
  
  #themeToggle, .back-btn {
    width: 40px;
    height: 40px;
    font-size: 0.9rem;
  }
  
  .game-modal-content {
    padding: 0.75rem;
    max-width: 95vw;
    max-height: 95vh;
    margin: 0.5rem;
    box-sizing: border-box;
  }
  
  .btn-game {
    padding: 7px 14px;
    font-size: 0.75rem;
  }
  
  .grid {
    gap: 0;
  }
}

@media (max-width: 480px) {
  .container {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }
  
  .game-card {
    padding: 0.625rem;
    margin-bottom: 0.375rem;
  }
  
  .game-icon {
    font-size: 1.75rem;
  }
  
  .game-icon-btn {
    min-height: 80px;
    padding: 0.375rem 0.125rem;
  }
  
  .game-icon-emoji {
    font-size: 1.25rem;
  }
  
  .game-icon-title {
    font-size: 0.6rem;
  }
  
  .game-icon-score {
    font-size: 0.5rem;
  }
  
  .btn-game {
    padding: 6px 12px;
    font-size: 0.7rem;
  }
  
  .grid {
    gap: 0;
  }
  
  .text-4xl {
    font-size: 1.75rem;
  }
  
  .text-6xl {
    font-size: 2.5rem;
  }
  
  .game-modal {
    padding: 0.5rem;
  }
  
  .game-modal-content {
    padding: 0.5rem;
    max-width: 96vw;
    max-height: 96vh;
    margin: 0.5rem;
    box-sizing: border-box;
  }
  
  .game-area .grid {
    gap: 0.25rem;
    padding: 0.25rem;
  }
}

/* 遊戲模態框 */
.game-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(8px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  padding: 1rem;
  box-sizing: border-box;
}

.game-modal.active {
  display: flex;
}

.game-modal-content {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: 12px;
  padding: 1rem;
  width: 100%;
  max-width: 90vw;
  height: 100%;
  max-height: 90vh;
  overflow: hidden;
  position: relative;
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
}

.dark .game-modal-content {
  background: rgba(26, 26, 46, 0.95);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.close-modal {
  position: absolute;
  top: 15px;
  right: 20px;
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #666;
}

.dark .close-modal {
  color: #ccc;
}

.close-modal:hover {
  color: #333;
}

.dark .close-modal:hover {
  color: #fff;
}

/* 遊戲內容區域 */
#gameContent {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

/* 遊戲區域自適應 */
.game-area {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

/* 遊戲網格自適應 */
.game-area .grid {
  flex: 1;
  overflow: hidden;
  display: grid;
  gap: 0;
  padding: 0;
}

/* 確保遊戲內容不會溢出 */
.game-area .grid > * {
  min-height: 0;
  overflow: hidden;
}

/* 手機版導航列優化 */
@media (max-width: 640px) {
  .bottom-nav {
    flex-wrap: nowrap;
    justify-content: space-around;
    padding: 0.5rem 0.25rem;
  }
  
  .bottom-nav button {
    flex: 1;
    min-width: 0;
    padding: 0.25rem 0.1rem;
    font-size: 0.7rem;
  }
  
  .bottom-nav button span:first-child {
    font-size: 1rem;
    margin-bottom: 0.125rem;
  }
}
</style>
</head>
<body>
<!-- 主題切換按鈕 -->
<button id="themeToggle" onclick="toggleTheme()" class="float">🌓</button>

<!-- 返回按鈕 -->
<button class="back-btn" onclick="goBack()" title="返回主頁">←</button>

  <!-- 頁面標題 -->
  <div class="container mx-auto px-3 py-3 pb-16">
    <div class="text-center mb-4">
      <h1 class="text-2xl md:text-4xl font-bold text-white mb-2 glow slide-in">🎮 遊戲大廳</h1>
      <p class="text-base text-white opacity-90 fade-in">選擇你喜歡的遊戲，放鬆一下！</p>
    </div>

  <!-- 總分顯示 -->
  <div class="glass rounded-xl p-2 mb-3 text-center">
    <h2 class="text-base font-bold text-white mb-1">🏆 總積分</h2>
    <div class="score-display">
      <span id="totalScore" class="text-xl font-bold text-indigo-600">0</span>
      <p class="text-gray-600 dark:text-gray-300 mt-1 text-xs">繼續遊戲獲得更多積分！</p>
    </div>
  </div>

  <!-- 遊戲按鈕網格 -->
  <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 mb-3">
    <!-- Wordle 文字猜謎 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('wordle')" ontouchstart="openGame('wordle')" title="Wordle - 猜出5字母單詞">
      <div class="game-icon-emoji float">📝</div>
      <div class="game-icon-title">Wordle</div>
      <div class="game-icon-score">最高: <span id="wordleHighScore">0</span></div>
    </div>

    <!-- 2048 數字合併 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('game2048')" ontouchstart="openGame('game2048')" title="2048 - 合併數字達到2048">
      <div class="game-icon-emoji glow">🔢</div>
      <div class="game-icon-title">2048</div>
      <div class="game-icon-score">最高: <span id="game2048HighScore">0</span></div>
    </div>

    <!-- 記憶配對遊戲 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('memory')" ontouchstart="openGame('memory')" title="記憶配對 - 點擊翻牌找出相同卡片">
      <div class="game-icon-emoji pulse">🧠</div>
      <div class="game-icon-title">記憶配對</div>
      <div class="game-icon-score">最高: <span id="memoryHighScore">0</span></div>
    </div>

    <!-- 反應測試遊戲 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('reaction')" ontouchstart="openGame('reaction')" title="反應測試 - 測試你的反應速度">
      <div class="game-icon-emoji bounce">⚡</div>
      <div class="game-icon-title">反應測試</div>
      <div class="game-icon-score">最高: <span id="reactionHighScore">0</span></div>
    </div>

    <!-- 數獨遊戲 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('sudoku')" ontouchstart="openGame('sudoku')" title="數獨 - 經典數字邏輯遊戲">
      <div class="game-icon-emoji rotate">🔲</div>
      <div class="game-icon-title">數獨</div>
      <div class="game-icon-score">最高: <span id="sudokuHighScore">0</span></div>
    </div>

    <!-- 俄羅斯方塊 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('tetris')" ontouchstart="openGame('tetris')" title="俄羅斯方塊 - 經典益智遊戲">
      <div class="game-icon-emoji float">🧩</div>
      <div class="game-icon-title">俄羅斯方塊</div>
      <div class="game-icon-score">最高: <span id="tetrisHighScore">0</span></div>
    </div>

    <!-- 貪吃蛇 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('snake')" ontouchstart="openGame('snake')" title="貪吃蛇 - 經典街機遊戲">
      <div class="game-icon-emoji pulse">🐍</div>
      <div class="game-icon-title">貪吃蛇</div>
      <div class="game-icon-score">最高: <span id="snakeHighScore">0</span></div>
    </div>

    <!-- 打地鼠 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('whack')" ontouchstart="openGame('whack')" title="打地鼠 - 點擊出現的地鼠">
      <div class="game-icon-emoji bounce">🐹</div>
      <div class="game-icon-title">打地鼠</div>
      <div class="game-icon-score">最高: <span id="whackHighScore">0</span></div>
    </div>


    <!-- 翻轉卡片 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('flipcard')" ontouchstart="openGame('flipcard')" title="翻轉卡片 - 記憶力挑戰">
      <div class="game-icon-emoji float">🃏</div>
      <div class="game-icon-title">翻轉卡片</div>
      <div class="game-icon-score">最高: <span id="flipcardHighScore">0</span></div>
    </div>

    <!-- 剪刀石頭布 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('rps')" ontouchstart="openGame('rps')" title="剪刀石頭布 - 經典對戰遊戲">
      <div class="game-icon-emoji pulse">✂️</div>
      <div class="game-icon-title">剪刀石頭布</div>
      <div class="game-icon-score">最高: <span id="rpsHighScore">0</span></div>
    </div>

    <!-- 消除三消 -->
    <div class="game-icon-btn touch-manipulation" onclick="openGame('match3')" ontouchstart="openGame('match3')" title="三消遊戲 - 連線消除寶石">
      <div class="game-icon-emoji bounce">💎</div>
      <div class="game-icon-title">三消遊戲</div>
      <div class="game-icon-score">最高: <span id="match3HighScore">0</span></div>
    </div>
  </div>

  <!-- 成就系統 -->
  <div class="glass rounded-xl p-3">
    <h2 class="text-lg font-bold text-white mb-2 text-center">🏅 成就系統</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
      <div class="achievement-item text-center p-2 rounded-lg bg-white bg-opacity-10">
        <div class="text-lg mb-1">🎮</div>
        <div class="text-xs text-white">遊戲新手</div>
        <div class="text-xs text-gray-300">玩過3個遊戲</div>
      </div>
      <div class="achievement-item text-center p-2 rounded-lg bg-white bg-opacity-10">
        <div class="text-lg mb-1">🏆</div>
        <div class="text-xs text-white">積分達人</div>
        <div class="text-xs text-gray-300">獲得5000分</div>
      </div>
      <div class="achievement-item text-center p-2 rounded-lg bg-white bg-opacity-10">
        <div class="text-lg mb-1">📝</div>
        <div class="text-xs text-white">Wordle大師</div>
        <div class="text-xs text-gray-300">Wordle連勝10次</div>
      </div>
      <div class="achievement-item text-center p-2 rounded-lg bg-white bg-opacity-10">
        <div class="text-lg mb-1">🧩</div>
        <div class="text-xs text-white">益智之王</div>
        <div class="text-xs text-gray-300">完成所有益智遊戲</div>
      </div>
    </div>
  </div>
</div>

<!-- 遊戲模態框 -->
<div id="gameModal" class="game-modal">
  <div class="game-modal-content">
    <button class="close-modal" onclick="closeGame()">×</button>
    <div id="gameContent"></div>
  </div>
</div>

<script src="mobile-games.js"></script>
<script>
// 主題切換
function toggleTheme() {
  document.body.classList.toggle('dark');
  localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}

// 載入主題
function loadTheme() {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') {
    document.body.classList.add('dark');
  }
}

// 返回主頁
function goBack() {
  window.location.href = 'index.html';
}

// 遊戲數據
let gameData = {
  totalScore: 0,
  highScores: {
    wordle: 0,
    game2048: 0,
    memory: 0,
    reaction: 0,
    sudoku: 0,
    tetris: 0,
    snake: 0,
    whack: 0,
    flipcard: 0,
    rps: 0,
    match3: 0
  },
  achievements: {
    gameNewbie: false,
    scoreMaster: false,
    memoryMaster: false,
    speedKing: false,
    wordleMaster: false,
    puzzleKing: false
  }
};

// 載入遊戲數據
function loadGameData() {
  const saved = localStorage.getItem('gameData');
  if (saved) {
    gameData = JSON.parse(saved);
    updateScoreDisplay();
  }
}

// 儲存遊戲數據
function saveGameData() {
  localStorage.setItem('gameData', JSON.stringify(gameData));
}

// 更新分數顯示
function updateScoreDisplay() {
  document.getElementById('totalScore').textContent = gameData.totalScore;
  document.getElementById('wordleHighScore').textContent = gameData.highScores.wordle;
  document.getElementById('game2048HighScore').textContent = gameData.highScores.game2048;
  document.getElementById('memoryHighScore').textContent = gameData.highScores.memory;
  document.getElementById('reactionHighScore').textContent = gameData.highScores.reaction;
  document.getElementById('sudokuHighScore').textContent = gameData.highScores.sudoku;
  document.getElementById('tetrisHighScore').textContent = gameData.highScores.tetris;
  document.getElementById('snakeHighScore').textContent = gameData.highScores.snake;
  document.getElementById('whackHighScore').textContent = gameData.highScores.whack;
  document.getElementById('flipcardHighScore').textContent = gameData.highScores.flipcard;
  document.getElementById('rpsHighScore').textContent = gameData.highScores.rps;
  document.getElementById('match3HighScore').textContent = gameData.highScores.match3;
}

// 開啟遊戲
function openGame(gameType) {
  console.log('開啟遊戲:', gameType);
  const modal = document.getElementById('gameModal');
  const content = document.getElementById('gameContent');
  
  if (!modal || !content) {
    console.error('找不到模態框元素');
    return;
  }
  
  // 清理之前的遊戲
  if (currentGameInstance) {
    closeGame();
  }
  
  // 先顯示模態框
  modal.classList.add('active');
  console.log('模態框已顯示');
  
  switch(gameType) {
    case 'wordle':
      content.innerHTML = createWordleGame();
      setTimeout(() => startWordleGame(), 100);
      break;
    case 'game2048':
      content.innerHTML = create2048Game();
      setTimeout(() => start2048Game(), 100);
      break;
    case 'memory':
      content.innerHTML = createMemoryGame();
      setTimeout(() => startMemoryGame(), 100);
      break;
    case 'reaction':
      content.innerHTML = createReactionGame();
      setTimeout(() => startReactionGame(), 100);
      break;
    case 'sudoku':
      content.innerHTML = createSudokuGame();
      setTimeout(() => startSudokuGame(), 100);
      break;
    case 'tetris':
      content.innerHTML = createTetrisGame();
      setTimeout(() => startTetrisGame(), 100);
      break;
    case 'snake':
      content.innerHTML = createSnakeGame();
      setTimeout(() => startSnakeGame(), 100);
      break;
    case 'whack':
      content.innerHTML = createWhackGame();
      setTimeout(() => startWhackGame(), 100);
      break;
    case 'flipcard':
      content.innerHTML = createFlipcardGame();
      setTimeout(() => startFlipcardGame(), 100);
      break;
    case 'rps':
      content.innerHTML = createRPSGame();
      setTimeout(() => startRPSGame(), 100);
      break;
    case 'match3':
      content.innerHTML = createMatch3Game();
      setTimeout(() => startMatch3Game(), 100);
      break;
  }
}

// 關閉遊戲
function closeGame() {
  const modal = document.getElementById('gameModal');
  modal.classList.remove('active');
  
  // 清理遊戲實例
  if (currentGameInstance) {
    // 停止所有計時器
    if (currentGameInstance.timer) {
      clearInterval(currentGameInstance.timer);
    }
    if (currentGameInstance.gameLoop) {
      clearInterval(currentGameInstance.gameLoop);
    }
    if (currentGameInstance.timeoutId) {
      clearTimeout(currentGameInstance.timeoutId);
    }
    
    // 清理全局函數
    if (window.selectNumber) {
      delete window.selectNumber;
    }
    if (window.closeNumberSelector) {
      delete window.closeNumberSelector;
    }
    if (window.makeGuess) {
      delete window.makeGuess;
    }
    
    currentGameInstance = null;
  }
  
  // 清理模態框內容
  const content = document.getElementById('gameContent');
  if (content) {
    content.innerHTML = '';
  }
}

// 更新分數
function updateScore(gameType, score) {
  if (score > gameData.highScores[gameType]) {
    gameData.highScores[gameType] = score;
  }
  gameData.totalScore += score;
  updateScoreDisplay();
  saveGameData();
  checkAchievements();
}

// 檢查成就
function checkAchievements() {
  // 遊戲新手
  const gamesPlayed = Object.values(gameData.highScores).filter(score => score > 0).length;
  if (gamesPlayed >= 3 && !gameData.achievements.gameNewbie) {
    gameData.achievements.gameNewbie = true;
    showAchievement('遊戲新手', '🎮');
  }
  
  // 積分達人
  if (gameData.totalScore >= 5000 && !gameData.achievements.scoreMaster) {
    gameData.achievements.scoreMaster = true;
    showAchievement('積分達人', '🏆');
  }
  
  // Wordle大師
  if (gameData.highScores.wordle >= 500 && !gameData.achievements.wordleMaster) {
    gameData.achievements.wordleMaster = true;
    showAchievement('Wordle大師', '📝');
  }
  
  // 益智之王
  const puzzleGames = ['sudoku', 'game2048', 'memory'];
  const puzzleCompleted = puzzleGames.every(game => gameData.highScores[game] > 0);
  if (puzzleCompleted && !gameData.achievements.puzzleKing) {
    gameData.achievements.puzzleKing = true;
    showAchievement('益智之王', '🧩');
  }
}

// 顯示成就
function showAchievement(title, icon) {
  const notification = document.createElement('div');
  notification.className = 'fixed top-20 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50';
  notification.innerHTML = `
    <div class="flex items-center">
      <span class="text-2xl mr-2">${icon}</span>
      <div>
        <div class="font-bold">成就解鎖！</div>
        <div class="text-sm">${title}</div>
      </div>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 3000);
}

// 記憶配對遊戲
function createMemoryGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">🧠 記憶配對</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="memoryScore" class="font-bold">0</span></span>
        <span>時間: <span id="memoryTime" class="font-bold">90</span>s</span>
        <span>移動: <span id="memoryMoves" class="font-bold">0</span></span>
      </div>
      <div id="memoryGrid" class="game-area flex-1 mb-2"></div>
      <div class="flex justify-center gap-2">
        <button onclick="startMemoryGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 滑動消除遊戲
function createEliminateGame() {
  return `
    <div class="text-center">
      <h2 class="text-2xl font-bold mb-4">🎯 滑動消除</h2>
      <div class="mb-4 flex justify-center gap-4 text-sm">
        <span>分數: <span id="eliminateScore" class="font-bold">0</span></span>
        <span>目標: <span id="eliminateTarget" class="font-bold">1000</span></span>
        <span>步數: <span id="eliminateMoves" class="font-bold">30</span></span>
      </div>
      <div id="eliminateGrid" class="game-area mb-4"></div>
      <div class="text-xs text-gray-600 mb-4">滑動相鄰方塊創造三個連線</div>
      <div class="flex justify-center gap-2">
        <button onclick="startEliminateGame()" class="btn-game text-sm">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-sm">關閉</button>
      </div>
    </div>
  `;
}

// 反應測試遊戲
function createReactionGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">⚡ 反應測試</h2>
      <div id="reactionArea" class="game-area flex-1 mb-2"></div>
      <div class="text-xs text-gray-600 mb-2">等按鈕變綠色時快速點擊</div>
      <div class="flex justify-center gap-2">
        <button onclick="startReactionGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 數字合併遊戲
function createMergeGame() {
  return `
    <div class="text-center">
      <h2 class="text-2xl font-bold mb-4">🔢 數字合併</h2>
      <div class="mb-4">
        <span class="text-lg">分數: <span id="mergeScore" class="font-bold">0</span></span>
      </div>
      <div id="mergeGrid" class="game-area mb-4"></div>
      <div id="mergeArea" class="mb-4">
        <div class="text-xs text-gray-600 mb-2">滑動螢幕控制方向</div>
        <div class="flex justify-center gap-1">
          <button onclick="currentGameInstance.move('up')" class="w-12 h-12 bg-gray-300 rounded text-lg">↑</button>
        </div>
        <div class="flex justify-center gap-1">
          <button onclick="currentGameInstance.move('left')" class="w-12 h-12 bg-gray-300 rounded text-lg">←</button>
          <button onclick="currentGameInstance.move('down')" class="w-12 h-12 bg-gray-300 rounded text-lg">↓</button>
          <button onclick="currentGameInstance.move('right')" class="w-12 h-12 bg-gray-300 rounded text-lg">→</button>
        </div>
      </div>
      <div class="flex justify-center gap-2">
        <button onclick="startMergeGame()" class="btn-game text-sm">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-sm">關閉</button>
      </div>
    </div>
  `;
}

// 數字拼圖遊戲
function createPuzzleGame() {
  return `
    <div class="text-center">
      <h2 class="text-3xl font-bold mb-4">🧩 數字拼圖</h2>
      <div class="mb-4">
        <span class="text-lg">移動次數: <span id="puzzleMoves">0</span></span>
        <span class="text-lg ml-4">時間: <span id="puzzleTime">0</span>s</span>
      </div>
      <div id="puzzleGrid" class="grid grid-cols-4 gap-1 max-w-md mx-auto"></div>
      <div class="mt-4">
        <button onclick="startPuzzleGame()" class="btn-game mr-2">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game">關閉</button>
      </div>
    </div>
  `;
}

// 房產大富翁遊戲
function createMonopolyGame() {
  return `
    <div class="text-center">
      <h2 class="text-3xl font-bold mb-4">🏠 房產大富翁</h2>
      <div class="mb-4">
        <span class="text-lg">資金: $<span id="monopolyMoney">1000</span></span>
        <span class="text-lg ml-4">回合: <span id="monopolyRound">1</span></span>
      </div>
      <div id="monopolyBoard" class="grid grid-cols-4 gap-2 max-w-lg mx-auto"></div>
      <div class="mt-4">
        <button onclick="startMonopolyGame()" class="btn-game mr-2">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game">關閉</button>
      </div>
    </div>
  `;
}

// 幸運轉盤遊戲
function createWheelGame() {
  return `
    <div class="text-center">
      <h2 class="text-3xl font-bold mb-4">🎯 幸運轉盤</h2>
      <div class="mb-4">
        <span class="text-lg">積分: <span id="wheelScore">0</span></span>
        <span class="text-lg ml-4">次數: <span id="wheelSpins">3</span></span>
      </div>
      <div class="relative w-64 h-64 mx-auto mb-4">
        <canvas id="wheelCanvas" width="256" height="256" class="border-4 border-gray-300 rounded-full"></canvas>
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2">
          <div class="w-0 h-0 border-l-4 border-r-4 border-b-8 border-l-transparent border-r-transparent border-b-red-500"></div>
        </div>
      </div>
      <div class="mt-4">
        <button onclick="spinWheel()" class="btn-game mr-2">轉動轉盤</button>
        <button onclick="closeGame()" class="btn-game">關閉</button>
      </div>
    </div>
  `;
}

// 2048遊戲
function create2048Game() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">🔢 2048</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="mergeScore" class="font-bold">0</span></span>
        <span>最高: <span id="game2048Best" class="font-bold">0</span></span>
      </div>
      <div id="mergeGrid" class="game-area flex-1 mb-2"></div>
      <div id="mergeArea" class="mb-2">
        <div class="text-xs text-gray-600 mb-1">滑動螢幕控制方向</div>
        <div class="flex justify-center gap-1 mb-1">
          <button onclick="currentGameInstance.move('up')" class="w-10 h-10 bg-gray-300 rounded text-sm touch-manipulation">↑</button>
        </div>
        <div class="flex justify-center gap-1">
          <button onclick="currentGameInstance.move('left')" class="w-10 h-10 bg-gray-300 rounded text-sm touch-manipulation">←</button>
          <button onclick="currentGameInstance.move('down')" class="w-10 h-10 bg-gray-300 rounded text-sm touch-manipulation">↓</button>
          <button onclick="currentGameInstance.move('right')" class="w-10 h-10 bg-gray-300 rounded text-sm touch-manipulation">→</button>
        </div>
      </div>
      <div class="flex justify-center gap-2">
        <button onclick="start2048Game()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// Wordle 遊戲
function createWordleGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">📝 Wordle</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>回合: <span id="wordleRound" class="font-bold">1</span>/6</span>
        <span>連勝: <span id="wordleStreak" class="font-bold">0</span></span>
      </div>
      <div id="wordleStatus" class="mb-2 text-xs font-bold text-center">
        <span class="text-gray-600">點擊「開始遊戲」開始猜詞</span>
      </div>
      <div id="wordleGrid" class="game-area flex-1 mb-2"></div>
      <div id="wordleKeyboard" class="mb-2"></div>
      <div class="text-xs text-gray-600 mb-2">猜出5字母單詞，綠色=正確位置，黃色=錯誤位置</div>
      <div id="wordleControls" class="flex justify-center gap-2">
        <button onclick="startWordleGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 數獨遊戲
function createSudokuGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">🔲 數獨</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>時間: <span id="sudokuTime" class="font-bold">0</span>s</span>
        <span>錯誤: <span id="sudokuErrors" class="font-bold">0</span></span>
      </div>
      <div id="sudokuGrid" class="game-area flex-1 mb-2"></div>
      
      <!-- 數字選擇鍵盤 -->
      <div id="sudokuNumberPad" class="mb-2">
        <div class="text-xs text-gray-600 mb-1">選擇數字</div>
        <div class="grid grid-cols-3 gap-1 max-w-xs mx-auto">
          <button onclick="currentGameInstance.selectNumber(1)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">1</button>
          <button onclick="currentGameInstance.selectNumber(2)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">2</button>
          <button onclick="currentGameInstance.selectNumber(3)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">3</button>
          <button onclick="currentGameInstance.selectNumber(4)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">4</button>
          <button onclick="currentGameInstance.selectNumber(5)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">5</button>
          <button onclick="currentGameInstance.selectNumber(6)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">6</button>
          <button onclick="currentGameInstance.selectNumber(7)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">7</button>
          <button onclick="currentGameInstance.selectNumber(8)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">8</button>
          <button onclick="currentGameInstance.selectNumber(9)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold hover:bg-blue-600 touch-manipulation">9</button>
        </div>
        <div class="flex justify-center gap-1 mt-1">
          <button onclick="currentGameInstance.clearCell()" class="w-16 h-8 bg-red-500 text-white rounded-lg text-xs font-bold hover:bg-red-600 touch-manipulation">清除</button>
          <button onclick="currentGameInstance.hint()" class="w-16 h-8 bg-yellow-500 text-white rounded-lg text-xs font-bold hover:bg-yellow-600 touch-manipulation">提示</button>
        </div>
      </div>
      
      <div class="text-xs text-gray-600 mb-2">點擊空白格子，然後選擇數字</div>
      <div class="flex justify-center gap-2">
        <button onclick="startSudokuGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 俄羅斯方塊
function createTetrisGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">🧩 俄羅斯方塊</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="tetrisScore" class="font-bold">0</span></span>
        <span>等級: <span id="tetrisLevel" class="font-bold">1</span></span>
        <span>行數: <span id="tetrisLines" class="font-bold">0</span></span>
      </div>
      <div id="tetrisGrid" class="game-area flex-1 mb-2"></div>
      
      <!-- 手機觸控按鈕 -->
      <div class="mb-2">
        <div class="text-xs text-gray-600 mb-1">觸控控制</div>
        <div class="flex justify-center gap-1 mb-1">
          <button onclick="currentGameInstance.movePiece(-1, 0)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold touch-manipulation">←</button>
          <button onclick="currentGameInstance.rotatePiece()" class="w-10 h-10 bg-purple-500 text-white rounded-lg text-sm font-bold touch-manipulation">↻</button>
          <button onclick="currentGameInstance.movePiece(1, 0)" class="w-10 h-10 bg-blue-500 text-white rounded-lg text-sm font-bold touch-manipulation">→</button>
        </div>
        <div class="flex justify-center gap-1">
          <button onclick="currentGameInstance.movePiece(0, 1)" class="w-10 h-10 bg-green-500 text-white rounded-lg text-sm font-bold touch-manipulation">↓</button>
          <button onclick="currentGameInstance.hardDrop()" class="w-20 h-10 bg-red-500 text-white rounded-lg text-xs font-bold touch-manipulation">快速下降</button>
        </div>
      </div>
      
      <div class="text-xs text-gray-600 mb-2">滑動螢幕控制：左右移動，向下加速，向上旋轉</div>
      <div class="flex justify-center gap-2">
        <button onclick="startTetrisGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 貪吃蛇
function createSnakeGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">🐍 貪吃蛇</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="snakeScore" class="font-bold">0</span></span>
        <span>長度: <span id="snakeLength" class="font-bold">1</span></span>
      </div>
      <div id="snakeGrid" class="game-area flex-1 mb-2"></div>
      <div class="text-xs text-gray-600 mb-2">使用方向鍵控制蛇的移動</div>
      <div class="flex justify-center gap-2">
        <button onclick="startSnakeGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 打地鼠
function createWhackGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">🐹 打地鼠</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="whackScore" class="font-bold">0</span></span>
        <span>時間: <span id="whackTime" class="font-bold">30</span>s</span>
        <span>擊中: <span id="whackHits" class="font-bold">0</span></span>
      </div>
      <div id="whackGrid" class="game-area flex-1 mb-2"></div>
      <div class="text-xs text-gray-600 mb-2">點擊出現的地鼠，獲得高分</div>
      <div class="flex justify-center gap-2">
        <button onclick="startWhackGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}


// 翻轉卡片 - 簡單配對遊戲
function createFlipcardGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">🃏 翻轉卡片</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="flipcardScore" class="font-bold">0</span></span>
        <span>翻轉: <span id="flipcardFlips" class="font-bold">0</span></span>
        <span>配對: <span id="flipcardPairs" class="font-bold">0</span>/8</span>
      </div>
      <div id="flipcardGrid" class="game-area flex-1 mb-2"></div>
      <div class="text-xs text-gray-600 mb-2">點擊卡片翻轉，找出相同的圖案配對</div>
      <div class="flex justify-center gap-2">
        <button onclick="startFlipcardGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="resetFlipcardGame()" class="btn-game text-xs px-3 py-1">重新開始</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 剪刀石頭布
function createRPSGame() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">✂️ 剪刀石頭布</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="rpsScore" class="font-bold">0</span></span>
        <span>連勝: <span id="rpsStreak" class="font-bold">0</span></span>
        <span>回合: <span id="rpsRound" class="font-bold">0</span></span>
      </div>
      
      <!-- 電腦選擇 -->
      <div class="mb-2">
        <div class="text-xs text-gray-600 mb-1">電腦選擇</div>
        <div id="computerChoice" class="text-4xl">🤖</div>
      </div>
      
      <!-- 玩家選擇 -->
      <div class="mb-2">
        <div class="text-xs text-gray-600 mb-1">你的選擇</div>
        <div class="flex justify-center gap-2">
          <button onclick="currentGameInstance.playRound('rock')" class="w-12 h-12 bg-gray-500 text-white rounded-full text-xl hover:bg-gray-600 touch-manipulation">🪨</button>
          <button onclick="currentGameInstance.playRound('paper')" class="w-12 h-12 bg-blue-500 text-white rounded-full text-xl hover:bg-blue-600 touch-manipulation">📄</button>
          <button onclick="currentGameInstance.playRound('scissors')" class="w-12 h-12 bg-red-500 text-white rounded-full text-xl hover:bg-red-600 touch-manipulation">✂️</button>
        </div>
      </div>
      
      <!-- 結果顯示 -->
      <div id="rpsResult" class="mb-2 text-sm font-bold"></div>
      
      <div class="flex justify-center gap-2">
        <button onclick="startRPSGame()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 三消遊戲 (使用消除遊戲邏輯)
function createMatch3Game() {
  return `
    <div class="text-center h-full flex flex-col">
      <h2 class="text-xl font-bold mb-2">💎 三消遊戲</h2>
      <div class="mb-2 flex justify-center gap-3 text-xs">
        <span>分數: <span id="eliminateScore" class="font-bold">0</span></span>
        <span>目標: <span id="eliminateTarget" class="font-bold">1000</span></span>
        <span>步數: <span id="eliminateMoves" class="font-bold">30</span></span>
      </div>
      <div id="eliminateGrid" class="game-area flex-1 mb-2"></div>
      <div class="text-xs text-gray-600 mb-2">滑動相鄰方塊創造三個連線</div>
      <div class="flex justify-center gap-2">
        <button onclick="startMatch3Game()" class="btn-game text-xs px-3 py-1">開始遊戲</button>
        <button onclick="closeGame()" class="btn-game text-xs px-3 py-1">關閉</button>
      </div>
    </div>
  `;
}

// 翻轉卡片遊戲函數
let flipcardGameInstance = null;

function startFlipcardGame() {
  if (flipcardGameInstance) {
    flipcardGameInstance = null;
  }
  flipcardGameInstance = new FlipcardGame();
  flipcardGameInstance.init();
}

function resetFlipcardGame() {
  if (flipcardGameInstance) {
    flipcardGameInstance.resetGame();
  } else {
    startFlipcardGame();
  }
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
  loadTheme();
  loadGameData();
});
</script>

<!-- 📍 底部導航 -->
<nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-gray-200 flex justify-around py-2 bottom-nav z-50" role="navigation" aria-label="主要導航">
  <button onclick="window.location.href='index.html'" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-3 py-2 min-w-[60px]" aria-label="回到首頁">
    <span class="text-lg mb-1">🏠</span><span>首頁</span>
  </button>
  <button onclick="openTool('expense-tracker.html')" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-3 py-2 min-w-[60px]" aria-label="記帳">
    <span class="text-lg mb-1">📝</span><span>記帳</span>
  </button>
  <button class="flex flex-col items-center text-indigo-600 text-xs font-semibold px-3 py-2 min-w-[60px]" aria-label="遊戲大廳">
    <span class="text-lg mb-1">🎮</span><span>遊戲</span>
  </button>
  <button onclick="openTool('local-life.html')" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-3 py-2 min-w-[60px]" aria-label="在地生活">
    <span class="text-lg mb-1">🍹</span><span>生活</span>
  </button>
  <button onclick="openTool('worship.html')" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-3 py-2 min-w-[60px]" aria-label="拜拜專區">
    <span class="text-lg mb-1">🙏</span><span>拜拜</span>
  </button>
</nav>

<script>
// 工具開啟功能
function openTool(url) {
  if (url.startsWith('http')) {
    // 檢測是否為手機版
    const isMobile = window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    
    if (isMobile) {
      // 手機版：在當前視窗打開外部連結
      window.location.href = url;
    } else {
      // 桌面版：在新視窗打開外部連結
      window.open(url, '_blank', 'noopener,noreferrer');
    }
  } else {
    // 內部連結在原視窗打開
    window.location.href = url;
  }
}
</script>
</body>
</html>
