<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>äºŒæ‰‹äº¤æ˜“ - æ¿¬ç‘’æˆ¿ç”¢ç”Ÿæ´»å¹³å°</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --grad: linear-gradient(135deg, #10b981, #059669);
}
.glass-card { background: rgba(255,255,255,0.8); backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,0.06); border-radius: 1rem; }
.btn { background: var(--grad); color: #fff; padding: 0.6rem 1rem; border-radius: 0.75rem; font-weight: 700; }
.btn:disabled { opacity: .6; cursor: not-allowed; }
.input { width: 100%; padding: .65rem .8rem; border: 1px solid #e5e7eb; border-radius: .75rem; }
.card { background: #fff; border: 1px solid #e5e7eb; border-radius: .75rem; padding: 1rem; }
/* å½ˆçª—æ¨£å¼ */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 1rem;
}
.modal-overlay.active {
  display: flex;
}
.modal-content {
  background: white;
  border-radius: 1rem;
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
  animation: slideUp 0.3s ease-out;
}
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.modal-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: #f3f4f6;
  border: none;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}
.modal-close:hover {
  background: #e5e7eb;
}
/* æ–°å¢æŒ‰éˆ• */
.add-button {
  position: fixed;
  bottom: 5rem;
  right: 1rem;
  background: var(--grad);
  color: white;
  width: 3.5rem;
  height: 3.5rem;
  border-radius: 50%;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
  z-index: 100;
  transition: transform 0.2s;
}
.add-button:hover {
  transform: scale(1.1);
}
</style>
</head>
<body class="bg-gradient-to-b from-emerald-50 to-white">

<header class="text-center py-6 text-white relative" style="background: var(--grad)">
  <h1 class="text-2xl md:text-3xl font-extrabold">â™»ï¸ äºŒæ‰‹äº¤æ˜“</h1>
  <p class="opacity-90 text-sm mt-1">åˆŠç™»äºŒæ‰‹ç‰©å“ï¼Œé™„ä¸Šç…§ç‰‡ã€è¯çµ¡äººèˆ‡é›»è©±</p>
</header>

<main class="max-w-3xl mx-auto p-4 space-y-6 pb-20">
  <!-- åˆŠç™»åˆ—è¡¨ -->
  <section class="space-y-3" id="listContainer" aria-live="polite"></section>
</main>

<!-- æ–°å¢åˆŠç™»æŒ‰éˆ• -->
<button class="add-button" onclick="openModal()" aria-label="æ–°å¢åˆŠç™»" title="æ–°å¢åˆŠç™»">
  â•
</button>

<!-- åˆŠç™»è¡¨å–®å½ˆçª— -->
<div id="modalOverlay" class="modal-overlay" onclick="closeModalOnOverlay(event)">
  <div class="modal-content glass-card p-4 md:p-6" onclick="event.stopPropagation()">
    <button class="modal-close" onclick="closeModal()" aria-label="é—œé–‰">âœ•</button>
    <h2 class="text-lg font-bold mb-4">ğŸ“ æ–°å¢åˆŠç™»</h2>
    <form id="listingForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">ç‰©å“åç¨±</label>
          <input id="itemTitle" type="text" class="input" placeholder="ä¾‹å¦‚ï¼šIKEA æ¡Œå­" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">è¯çµ¡äºº</label>
          <input id="contactName" type="text" class="input" placeholder="æ‚¨çš„ç¨±å‘¼" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">è¯çµ¡é›»è©±</label>
          <input id="contactPhone" type="tel" class="input" placeholder="09xx-xxx-xxx" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">ç…§ç‰‡é€£çµï¼ˆå¯é¸ï¼‰</label>
          <input id="imageUrl" type="url" class="input" placeholder="https://...ï¼ˆæˆ–é¸æ“‡æª”æ¡ˆä¸Šå‚³ï¼‰">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">æˆ–é¸æ“‡æª”æ¡ˆä¸Šå‚³</label>
          <input id="imageFile" type="file" accept="image/*" class="input">
          <p class="text-xs text-gray-500 mt-1">è‹¥åŒæ™‚å¡«å¯«é€£çµèˆ‡é¸æª”ï¼Œå„ªå…ˆä½¿ç”¨ä¸Šå‚³æª”æ¡ˆã€‚</p>
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">ç‰©å“æè¿°</label>
        <textarea id="itemDesc" class="input" rows="3" placeholder="ç‹€æ³ã€å°ºå¯¸ã€åƒ¹æ ¼ã€å–è²¨åœ°é»ç­‰"></textarea>
      </div>
      <div class="flex items-center gap-3">
        <button type="submit" class="btn">ç™¼å¸ƒ</button>
        <button type="button" onclick="closeModal()" class="px-3 py-2 rounded-lg border text-sm">å–æ¶ˆ</button>
      </div>
    </form>
  </div>
</div>

<!-- ğŸ“ åº•éƒ¨å°èˆªï¼ˆèˆ‡ä¸»é ä¸€è‡´ï¼‰ -->
<nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-gray-200 flex justify-around py-2 bottom-nav" role="navigation" aria-label="ä¸»è¦å°èˆª">
  <button onclick="window.location.href='index.html'" class="flex flex-col items-center text-indigo-600 text-xs hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-2 py-1" aria-label="å›åˆ°é¦–é ">
    <span>ğŸ </span><span>é¦–é </span>
  </button>
  <button onclick="openTool('investor.html')" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-2 py-1" aria-label="æŠ•è³‡å°ˆå€">
    <span>ğŸ’°</span><span>æŠ•è³‡</span>
  </button>
  <button onclick="openTool('games.html')" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-2 py-1" aria-label="éŠæˆ²å¤§å»³">
    <span>ğŸ®</span><span>éŠæˆ²</span>
  </button>
  <button onclick="window.location.href='https://flyjung168.pages.dev/'" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-2 py-1" aria-label="æˆ¿è¨Š">
    <span>ğŸ¹</span><span>æˆ¿è¨Š</span>
  </button>
  <button onclick="openTool('analytics.html')" class="flex flex-col items-center text-gray-600 text-xs hover:text-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 rounded-lg px-2 py-1" aria-label="æ•¸æ“šåˆ†æ">
    <span>ğŸ“Š</span><span>åˆ†æ</span>
  </button>
  
</nav>

<script>
// Firebase SDKï¼ˆé›²ç«¯å„²å­˜ï¼‰
// è‹¥å°šæœªå»ºç«‹å°ˆæ¡ˆï¼Œå¯å…ˆä¿ç•™æ­¤æ®µï¼Œç¨å¾Œæ›¿æ› config å…§å®¹
document.write('\n<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"><\\/script>');
document.write('\n<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"><\\/script>');

window.__FIREBASE_CONFIG__ = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

let firebaseApp = null;
let firebaseStorage = null;
try {
  if (window.firebase && window.__FIREBASE_CONFIG__ && window.__FIREBASE_CONFIG__.apiKey !== 'YOUR_API_KEY') {
    firebaseApp = firebase.initializeApp(window.__FIREBASE_CONFIG__);
    firebaseStorage = firebase.storage();
  }
} catch (err) {
  console.warn('Firebase åˆå§‹åŒ–å¤±æ•—ï¼Œå°‡æ”¹ç”¨æœ¬æ©Ÿ DataURLã€‚', err);
}

function openTool(url) {
  if (url.startsWith('http')) {
    window.open(url, '_blank', 'noopener,noreferrer');
  } else {
    window.location.href = url;
  }
}

const STORAGE_KEY = 'secondHandListings_v1';

function readListings() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch { return []; }
}
function writeListings(list) { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

function renderListings() {
  const container = document.getElementById('listContainer');
  const list = readListings();
  if (list.length === 0) {
    container.innerHTML = '<div class="text-center text-sm text-gray-500">å°šç„¡åˆŠç™»ï¼Œå¿«ä¾†æˆç‚ºç¬¬ä¸€ä½ï¼</div>';
    return;
  }
  container.innerHTML = list.map((it, idx) => `
    <div class="card flex gap-3 items-start">
      <div class="w-24 h-24 bg-gray-100 rounded overflow-hidden flex-shrink-0">
        ${it.imageUrl ? `<img src="${it.imageUrl}" class="w-full h-full object-cover" alt="${it.title}">` : `<div class="w-full h-full flex items-center justify-center text-gray-400">ç„¡åœ–</div>`}
      </div>
      <div class="flex-1">
        <div class="font-bold">${it.title}</div>
        <div class="text-sm text-gray-600 mt-1">${it.desc || ''}</div>
        <div class="text-sm mt-2">ğŸ‘¤ ${it.name}ã€€ğŸ“ <a href="tel:${it.phone}" class="text-emerald-600">${it.phone}</a></div>
      </div>
      <button class="text-xs text-red-600" onclick="removeListing(${idx})">åˆªé™¤</button>
    </div>
  `).join('');
}

function removeListing(index) {
  const list = readListings();
  list.splice(index, 1);
  writeListings(list);
  renderListings();
}

// å½ˆçª—æ§åˆ¶
function openModal() {
  document.getElementById('modalOverlay').classList.add('active');
  document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»¾å‹•
}

function closeModal() {
  document.getElementById('modalOverlay').classList.remove('active');
  document.body.style.overflow = ''; // æ¢å¾©æ»¾å‹•
  // æ¸…ç©ºè¡¨å–®
  document.getElementById('listingForm').reset();
}

function closeModalOnOverlay(event) {
  if (event.target.id === 'modalOverlay') {
    closeModal();
  }
}

// ESC éµé—œé–‰å½ˆçª—
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal();
  }
});

document.getElementById('listingForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const title = document.getElementById('itemTitle').value.trim();
  const name = document.getElementById('contactName').value.trim();
  const phone = document.getElementById('contactPhone').value.trim();
  const imageUrlInput = document.getElementById('imageUrl').value.trim();
  const imageFile = document.getElementById('imageFile').files[0];
  const desc = document.getElementById('itemDesc').value.trim();
  if (!title || !name || !phone) return;

  // è®€å–æª”æ¡ˆç‚º DataURLï¼ˆè‹¥æœ‰é¸æª”ï¼‰
  let finalImageUrl = imageUrlInput;
  if (imageFile) {
    // å„ªå…ˆå˜—è©¦ä¸Šå‚³åˆ° Firebase Storage
    if (firebaseStorage) {
      try {
        const safeName = `${Date.now()}_${(imageFile.name || 'image').replace(/[^a-zA-Z0-9._-]/g,'_')}`;
        const refPath = `second-hand/${safeName}`;
        const storageRef = firebaseStorage.ref().child(refPath);
        await storageRef.put(imageFile);
        finalImageUrl = await storageRef.getDownloadURL();
      } catch (uploadErr) {
        console.warn('é›²ç«¯ä¸Šå‚³å¤±æ•—ï¼Œæ”¹ç”¨æœ¬æ©Ÿ DataURLã€‚', uploadErr);
        finalImageUrl = await new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(imageFile);
        });
      }
    } else {
      // æœªåˆå§‹åŒ–æˆ–æœªè¨­å®š Firebaseï¼Œä½¿ç”¨ DataURL é è¦½
      finalImageUrl = await new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(imageFile);
      });
    }
  }

  const list = readListings();
  list.unshift({ title, name, phone, imageUrl: finalImageUrl, desc, createdAt: Date.now() });
  writeListings(list);
  (e.target).reset();
  renderListings();
  closeModal(); // æäº¤å¾Œé—œé–‰å½ˆçª—
});

renderListings();
</script>

</body>
</html>


