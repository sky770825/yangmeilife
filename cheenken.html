<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes" />
  <title>極品鹽水雞｜線上預訂</title>
  <style>
    :root{
      --bg: linear-gradient(135deg, #fef9f3 0%, #faf5ed 100%);
      --card:#ffffff;
      --text:#1a1a1a;
      --primary:#d97706;
      --primary-dark:#b45309;
      --accent:#f59e0b;
      --success:#059669;
      --danger:#dc2626;
      --muted:#6b7280;
      --border:#e5e7eb;
      --shadow: 0 4px 20px rgba(0,0,0,.06);
      --shadow-lg: 0 10px 40px rgba(0,0,0,.12);
      --radius: clamp(10px, 2vw, 16px);
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
    body{
      margin:0; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #fef9f3;
      background: var(--bg);
      color:var(--text); 
      line-height:1.6;
      font-size: clamp(15px, 3.5vw, 16px);
      letter-spacing: 0.3px;
      padding-bottom: 20px;
    }
    
    /* Header 品牌區 */
    .brand-header{
      background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
      color:#fff;
      padding: clamp(12px, 3vw, 18px) clamp(12px, 3vw, 16px);
      text-align:center;
      box-shadow: 0 4px 16px rgba(217,119,6,.25);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .brand-logo-wrap{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: clamp(8px, 2vw, 12px);
      margin-bottom: 4px;
    }
    .brand-logo{
      width: clamp(40px, 10vw, 56px);
      height: clamp(40px, 10vw, 56px);
      border-radius: 50%;
      background: #fff;
      padding: 6px;
      cursor: pointer;
      transition: transform .2s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }
    .brand-logo:hover{ transform: scale(1.05); }
    .brand-logo:active{ transform: scale(0.98); }
    .brand-title{
      font-size: clamp(20px, 4.5vw, 24px);
      font-weight: 800;
      margin:0;
      letter-spacing: 0.5px;
    }
    .brand-subtitle{
      font-size: clamp(12px, 2.5vw, 13px);
      opacity:.9;
      margin: 2px 0 0;
      font-weight: 400;
    }
    
    /* 容器 */
    .container{
      max-width: 1200px;
      margin: 0 auto;
      padding: clamp(12px, 3vw, 16px);
    }
    
    /* 卡片 */
    .card{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(14px, 3.5vw, 18px);
      margin-bottom: clamp(12px, 3vw, 16px);
    }
    
    /* 區塊標題 */
    .section-title{
      font-size: clamp(17px, 4.2vw, 19px);
      font-weight: 700;
      margin: 0 0 clamp(12px, 3vw, 14px);
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
      letter-spacing: 0.5px;
      line-height: 1.4;
    }
    .section-title::before{
      content: '';
      width: 4px;
      height: clamp(17px, 4vw, 20px);
      background: var(--primary);
      border-radius: 2px;
    }
    
    /* 表單欄位 */
    .form-group{
      margin-bottom: clamp(12px, 3vw, 14px);
    }
    .form-label{
      display: block;
      font-weight: 600;
      margin-bottom: clamp(6px, 1.5vw, 7px);
      font-size: clamp(14px, 3.2vw, 15px);
      color: var(--text);
      letter-spacing: 0.3px;
      line-height: 1.5;
    }
    .form-label .required{ color: var(--danger); margin-left: 2px; }
    
    input, select, textarea{
      width: 100%;
      padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 14px);
      border: 1.5px solid var(--border);
      border-radius: clamp(8px, 2vw, 10px);
      background: #fff;
      font-size: clamp(15px, 3.5vw, 16px);
      font-family: inherit;
      transition: all .2s ease;
      color: var(--text);
      letter-spacing: 0.3px;
      line-height: 1.5;
    }
    input:focus, select:focus, textarea:focus{
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(217,119,6,.12);
    }
    textarea{ min-height: clamp(70px, 18vw, 90px); resize: vertical; }
    
    /* 商品網格 - 多欄響應式 */
    .product-grid{
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* 手機預設 2 欄 */
      gap: clamp(10px, 2.5vw, 12px);
    }
    @media(min-width: 600px){
      .product-grid{ grid-template-columns: repeat(3, 1fr); } /* 平板 3 欄 */
    }
    @media(min-width: 900px){
      .product-grid{ grid-template-columns: repeat(4, 1fr); } /* 電腦 4 欄 */
    }
    
    /* 單點配菜 - 分類容器 */
    .side-list{
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* 手機 2 欄 */
      gap: clamp(8px, 2vw, 10px);
      align-items: start;
    }
    @media(min-width: 768px){
      .side-list{ grid-template-columns: repeat(3, 1fr); } /* 平板 3 欄 */
    }
    @media(min-width: 1024px){
      .side-list{ grid-template-columns: repeat(4, 1fr); } /* 電腦 4 欄 */
    }
    
    .side-item{
      display: flex;
      align-items: center;
      gap: clamp(5px, 1.2vw, 7px);
      padding: clamp(7px, 1.8vw, 9px);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: clamp(6px, 1.5vw, 8px);
      transition: all .2s ease;
    }
    .side-item:has(input:not([value="0"])){
      border-color: var(--primary);
      background: #fffbeb;
    }
    .side-item-name{
      flex: 1;
      font-size: clamp(14px, 3.2vw, 15px);
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      letter-spacing: 0.3px;
    }
    .side-item .qty-control{
      padding: clamp(1px, 0.3vw, 2px);
      flex-shrink: 0;
    }
    .side-item .qty-control input{
      width: clamp(28px, 7vw, 32px);
      font-size: clamp(13px, 3vw, 14px);
    }
    .side-item .qty-btn{
      width: clamp(20px, 5vw, 24px);
      height: clamp(20px, 5vw, 24px);
      font-size: clamp(12px, 3vw, 14px);
    }
    .side-item .eye-icon{
      cursor: pointer;
      font-size: clamp(16px, 4vw, 18px);
      opacity: 0.6;
      transition: all .2s ease;
      flex-shrink: 0;
    }
    .side-item .eye-icon:hover{
      opacity: 1;
      transform: scale(1.2);
    }
    
    /* 分類區塊 */
    .category-block{
      display: flex;
      flex-direction: column;
    }
    
    /* 分類標題（可點擊摺疊） */
    .category-title{
      font-size: clamp(14px, 3.2vw, 15px);
      font-weight: 700;
      color: var(--primary);
      background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
      padding: clamp(10px, 2.5vw, 12px) clamp(12px, 3vw, 14px);
      border-radius: clamp(8px, 2vw, 10px);
      border: 1.5px solid #fed7aa;
      cursor: pointer;
      user-select: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all .2s ease;
      letter-spacing: 0.3px;
      line-height: 1.4;
    }
    .category-title:hover{
      background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
    }
    .category-title:active{
      transform: scale(0.98);
    }
    .category-title .toggle-icon{
      font-size: clamp(16px, 4vw, 18px);
      transition: transform .2s ease;
    }
    .category-title.active .toggle-icon{
      transform: rotate(180deg);
    }
    
    /* 分類內容（可摺疊） */
    .category-content{
      display: flex;
      flex-direction: column;
      gap: clamp(4px, 1vw, 5px);
      margin-top: clamp(4px, 1vw, 5px);
      max-height: 0;
      overflow: hidden;
      transition: max-height .3s ease;
    }
    .category-content.active{
      max-height: 2000px;
    }
    
    /* 商品卡片 */
    .product-card{
      background: #fff;
      border: 1.5px solid var(--border);
      border-radius: clamp(6px, 1.5vw, 10px);
      padding: clamp(6px, 1.5vw, 8px);
      transition: all .25s ease;
      position: relative;
    }
    .product-card:has(input[type="number"]:not([value="0"])){
      border-color: var(--primary);
      box-shadow: 0 2px 8px rgba(217,119,6,.15);
    }
    .product-card:active{ transform: scale(0.98); }
    
    /* 缺貨商品樣式 */
    .product-card.out-of-stock{
      opacity: 0.6;
      pointer-events: none;
    }
    .product-card.out-of-stock .product-image-wrap{
      filter: grayscale(50%);
    }
    
    /* 缺貨標籤 */
    .out-of-stock-badge{
      position: absolute;
      top: 8px;
      right: 8px;
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      color: #fff;
      padding: clamp(4px, 1vw, 6px) clamp(8px, 2vw, 12px);
      border-radius: clamp(4px, 1vw, 6px);
      font-size: clamp(11px, 2.5vw, 12px);
      font-weight: 700;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(220, 38, 38, 0.4);
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      gap: 4px;
      animation: pulse 2s ease-in-out infinite;
    }
    .out-of-stock-badge::before{
      content: '✕';
      font-size: clamp(12px, 2.8vw, 14px);
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    /* 菜單圖片容器 */
    .menu-image-wrap{
      position: relative;
      width: 100%;
      padding-top: 75%; /* 4:3 比例 */
      border-radius: clamp(6px, 1.5vw, 10px);
      overflow: hidden;
      cursor: pointer;
      background: #f3f4f6;
      border: 1.5px solid var(--border);
      transition: all .25s ease;
    }
    .menu-image-wrap:hover{
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(217,119,6,.2);
    }
    .menu-image{
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain; /* 完整顯示圖片 */
      object-position: center;
      transition: transform .3s ease;
    }
    .menu-image-wrap:hover .menu-image{
      transform: scale(1.02);
    }
    .menu-image-wrap::after{
      content: '🔍 點擊放大';
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0,0,0,.7);
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: clamp(10px, 2.2vw, 11px);
      opacity: 0;
      transition: opacity .2s ease;
    }
    .menu-image-wrap:hover::after{
      opacity: 1;
    }
    
    .product-image-wrap{
      position: relative;
      width: 100%;
      padding-top: 75%; /* 改為 4:3 比例，讓圖片不那麼大 */
      border-radius: clamp(4px, 1vw, 6px);
      overflow: hidden;
      margin-bottom: clamp(5px, 1.2vw, 6px);
      cursor: pointer;
      background: #f3f4f6;
    }
    .product-image{
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover; /* 置中裁切 */
      object-position: center;
      transition: transform .3s ease;
    }
    .product-image-wrap:hover .product-image{
      transform: scale(1.05);
    }
    .product-image-wrap::after{
      content: '🔍';
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(0,0,0,.6);
      color: #fff;
      width: clamp(20px, 5vw, 24px);
      height: clamp(20px, 5vw, 24px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(10px, 2.5vw, 12px);
      opacity: 0;
      transition: opacity .2s ease;
    }
    .product-image-wrap:hover::after{
      opacity: 1;
    }
    
    .product-name{
      font-size: clamp(13px, 2.8vw, 14px);
      font-weight: 600;
      margin-bottom: clamp(3px, 0.8vw, 4px);
      color: var(--text);
      line-height: 1.2;
    }
    .product-price{
      font-size: clamp(14px, 3vw, 15px);
      font-weight: 700;
      color: var(--primary);
      margin-bottom: clamp(5px, 1.2vw, 6px);
    }
    .product-qty{
      display: flex;
      align-items: center;
      gap: clamp(4px, 1vw, 5px);
    }
    .product-qty input{
      width: 100%;
      text-align: center;
      padding: clamp(5px, 1.2vw, 6px);
      font-weight: 600;
      font-size: clamp(13px, 3vw, 15px);
    }
    .product-qty select{
      padding: clamp(4px, 1vw, 5px) clamp(6px, 1.5vw, 8px);
      font-size: clamp(10px, 2.2vw, 12px);
      margin-top: clamp(4px, 1vw, 5px);
    }
    
    /* 數量控制按鈕 */
    .qty-control{
      display: flex;
      align-items: center;
      gap: clamp(3px, 0.8vw, 4px);
      background: #fff;
      border: 1.5px solid var(--border);
      border-radius: clamp(6px, 1.5vw, 8px);
      padding: clamp(2px, 0.5vw, 3px);
      transition: all .2s ease;
    }
    .qty-control:has(input:not([value="0"])){
      border-color: var(--primary);
      background: #fffbeb;
    }
    .qty-btn{
      width: clamp(24px, 6vw, 28px);
      height: clamp(24px, 6vw, 28px);
      border: none;
      background: var(--primary);
      color: #fff;
      border-radius: clamp(4px, 1vw, 6px);
      font-size: clamp(14px, 3.5vw, 16px);
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s ease;
      user-select: none;
      flex-shrink: 0;
      padding: 0;
      line-height: 1;
    }
    .qty-btn:active{
      transform: scale(0.9);
      background: var(--primary-dark);
    }
    .qty-btn:hover{
      background: var(--primary-dark);
    }
    .qty-control input{
      border: none;
      background: transparent;
      width: clamp(36px, 9vw, 42px);
      text-align: center;
      padding: clamp(4px, 1vw, 5px);
      font-weight: 600;
      font-size: clamp(14px, 3.2vw, 15px);
      appearance: textfield; /* 標準屬性 */
      -moz-appearance: textfield; /* Firefox */
    }
    .qty-control input::-webkit-outer-spin-button,
    .qty-control input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .qty-control input:focus{
      box-shadow: none;
    }
    
    /* 總計 */
    .total-section{
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      padding: clamp(10px, 2.5vw, 14px);
      border-radius: var(--radius);
      margin: clamp(10px, 2.5vw, 12px) 0;
    }
    .total-row{
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .total-label{
      font-size: clamp(15px, 3.5vw, 16px);
      font-weight: 600;
    }
    .total-amount{
      font-size: clamp(22px, 5vw, 26px);
      font-weight: 800;
      color: var(--primary);
    }
    
    /* 按鈕 */
    .btn-group{
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: clamp(8px, 2vw, 10px);
      margin-top: clamp(10px, 2.5vw, 12px);
    }
    button{
      padding: clamp(10px, 2.2vw, 12px) clamp(12px, 3vw, 16px);
      border: none;
      border-radius: clamp(6px, 1.5vw, 8px);
      font-size: clamp(14px, 3vw, 15px);
      font-weight: 700;
      cursor: pointer;
      transition: all .2s ease;
      font-family: inherit;
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
      color: #fff;
      box-shadow: 0 3px 10px rgba(217,119,6,.3);
    }
    .btn-primary:hover{ box-shadow: 0 4px 14px rgba(217,119,6,.4); transform: translateY(-1px); }
    .btn-primary:active{ transform: translateY(0); }
    
    .btn-ghost{
      background: #fff;
      color: var(--muted);
      border: 1.5px solid var(--border);
    }
    .btn-ghost:hover{ border-color: var(--muted); }
    
    /* 訊息 */
    .message{
      margin-top: clamp(8px, 2vw, 10px);
      padding: clamp(8px, 2vw, 10px);
      border-radius: clamp(4px, 1vw, 6px);
      font-size: clamp(13px, 2.8vw, 14px);
      font-weight: 600;
    }
    .message.success{
      background: #d1fae5;
      color: var(--success);
      border: 1.5px solid var(--success);
    }
    .message.error{
      background: #fee2e2;
      color: var(--danger);
      border: 1.5px solid var(--danger);
    }
    
    /* 預覽區 */
    .preview-box{
      background: #f9fafb;
      padding: clamp(10px, 2.5vw, 12px);
      border-radius: clamp(6px, 1.5vw, 8px);
      border: 1.5px dashed var(--border);
      min-height: 80px;
      font-size: clamp(13px, 2.8vw, 14px);
      line-height: 1.6;
    }
    .preview-empty{
      color: var(--muted);
      text-align: center;
      padding: clamp(15px, 4vw, 20px);
    }
    .preview-item{
      padding: clamp(4px, 1vw, 5px) 0;
      border-bottom: 1px solid var(--border);
    }
    .preview-item:last-child{ border-bottom: none; }
    
    /* Logo 放大模態框 */
    .modal{
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.8);
      z-index: 999;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }
    .modal.active{ display: flex; }
    .modal-content{
      max-width: 90%;
      max-height: 90%;
      border-radius: var(--radius);
      animation: zoomIn .2s ease;
    }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
    @keyframes zoomIn{ from{transform:scale(.8)} to{transform:scale(1)} }
    
    /* 預覽+總計區域容器 */
    .summary-grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: clamp(8px, 2vw, 10px);
    }
    
    /* 口味客製網格 */
    .taste-grid{
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* 手機 2x2 */
      gap: clamp(8px, 2vw, 10px);
    }
    
    /* 響應式調整 */
    @media(min-width: 768px){
      .container{ padding: clamp(12px, 3vw, 18px); }
      .brand-header{ padding: clamp(16px, 4vw, 24px) clamp(16px, 3vw, 20px); }
      .summary-grid{ grid-template-columns: 1.2fr 0.8fr; } /* 電腦版：預覽較寬，總計較窄 */
      .taste-grid{ grid-template-columns: repeat(4, 1fr); } /* 電腦版：一行 4 欄 */
    }
  </style>
</head>
<body>
  <!-- 品牌 Header -->
  <header class="brand-header">
    <div class="brand-logo-wrap">
      <img 
        src="https://images.unsplash.com/photo-1598103442097-8b74394b95c6?w=200&h=200&fit=crop&q=80" 
        alt="極品鹽水雞" 
        class="brand-logo"
        id="brandLogo"
      />
      <div>
        <h1 class="brand-title">極品鹽水雞</h1>
        <p class="brand-subtitle">📍 定點餐車｜預訂取餐</p>
      </div>
    </div>
    </header>

  <div class="container">
    <form id="orderForm" autocomplete="on">
      
      <!-- 菜單圖片 -->
      <div class="card">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: clamp(8px, 2vw, 12px);">
          <div class="menu-image-wrap" data-image="https://i.postimg.cc/FKLFbHb9/image.jpg" data-name="菜單1">
            <img src="https://i.postimg.cc/FKLFbHb9/image.jpg" alt="菜單1" class="menu-image" loading="lazy" />
          </div>
          <div class="menu-image-wrap" data-image="https://i.postimg.cc/TwvdtvQ1/image.jpg" data-name="菜單2">
            <img src="https://i.postimg.cc/TwvdtvQ1/image.jpg" alt="菜單2" class="menu-image" loading="lazy" />
          </div>
        </div>
      </div>

      <!-- 基本資料卡片 -->
      <div class="card">
        <h2 class="section-title">訂購資料</h2>
        
        <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:clamp(12px,3vw,16px);">
          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">餐群姓名 & 群組ID<span class="required">*</span></label>
            <input required name="name" placeholder="例如：王小明 #A123" autocomplete="off" />
          </div>

          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">手機末3碼或全碼<span class="required">*</span></label>
            <input required name="phone" type="text" placeholder="例如：123 或 0912345678" autocomplete="tel" />
          </div>
        </div>

        <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:clamp(12px,3vw,16px); margin-top:clamp(14px,3.5vw,18px);">
          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">取餐方式<span class="required">*</span></label>
            <select required name="method">
              <option value="現場自取">🚶 現場自取</option>
              <option value="託人代取">👥 託人代取</option>
            </select>
          </div>

          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">預計取餐時間<span class="required">*</span></label>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:clamp(8px,2vw,10px);">
              <select required id="etaHour" style="border-color:var(--accent); font-weight:600;">
                <option value="">時</option>
                <option value="14">14 點</option>
                <option value="15">15 點</option>
                <option value="16">16 點</option>
                <option value="17">17 點</option>
                <option value="18">18 點</option>
                <option value="19">19 點</option>
                <option value="20">20 點</option>
              </select>
              <select required id="etaMinute" style="border-color:var(--accent); font-weight:600;">
                <option value="">分</option>
                <option value="00">00 分</option>
                <option value="05">05 分</option>
                <option value="10">10 分</option>
                <option value="15">15 分</option>
                <option value="20">20 分</option>
                <option value="25">25 分</option>
                <option value="30">30 分</option>
                <option value="35">35 分</option>
                <option value="40">40 分</option>
                <option value="45">45 分</option>
                <option value="50">50 分</option>
                <option value="55">55 分</option>
              </select>
            </div>
            <input type="hidden" name="eta" id="etaCombined" />
          </div>
          </div>
        </div>

      <!-- 主餐區 -->
      <div class="card">
        <h2 class="section-title">主餐選擇 <span style="color:var(--primary);font-size:clamp(14px,3.5vw,16px)">$150/份</span></h2>
        <div class="product-grid" id="mains"></div>
      </div>

      <!-- 單點區 -->
      <div class="card">
        <h2 class="section-title">單點配菜 <span style="color:var(--primary);font-size:clamp(14px,3.5vw,16px)">$30/份</span></h2>
        <div class="side-list" id="sides"></div>
            </div>

      <!-- 口味客製 -->
      <div class="card">
        <h2 class="section-title">口味客製</h2>
        <div class="taste-grid">
          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">🌶️ 辣度</label>
            <select name="spicy">
              <option value="不辣">不辣</option>
              <option value="微辣">微辣</option>
              <option value="小辣">小辣</option>
              <option value="中辣">中辣</option>
              <option value="大辣">大辣</option>
            </select>
          </div>

          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">🧂 鹹度</label>
            <select name="saltiness">
              <option value="清淡">清淡</option>
              <option value="正常" selected>正常</option>
              <option value="重鹹">重鹹</option>
            </select>
          </div>

          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">🍋 檸檬</label>
            <select name="lemon">
              <option value="加檸檬" selected>加檸檬</option>
              <option value="不加檸檬">不加檸檬</option>
            </select>
            </div>

          <div class="form-group" style="margin-bottom:0">
            <label class="form-label">🧅 蔥泥</label>
            <select name="scallion">
              <option value="加蔥泥" selected>加蔥泥</option>
              <option value="不加蔥泥">不加蔥泥</option>
            </select>
          </div>
        </div>

        <div class="form-group" style="margin-top:clamp(16px,4vw,18px); margin-bottom:0;">
          <label class="form-label">💬 備註說明</label>
          <textarea name="note" placeholder="例如：不吃香菜、多黃瓜、去骨…"></textarea>
        </div>
      </div>

      <!-- 訂單預覽 + 總計（多欄佈局） -->
      <div class="summary-grid">
        
        <!-- 訂單預覽 -->
        <div class="card">
          <h2 class="section-title">📋 訂單預覽</h2>
          <div class="preview-box" id="preview">
            <div class="preview-empty">尚未選擇商品</div>
          </div>
        </div>

        <!-- 總計與按鈕 -->
        <div class="card">
          <div class="total-section">
            <div class="total-row">
              <span class="total-label">訂單總額</span>
              <span class="total-amount" id="totalAmt">$0</span>
            </div>
          </div>

          <div class="btn-group">
            <button type="button" class="btn-ghost" id="resetBtn">清空重填</button>
            <button type="submit" class="btn-primary">✓ 送出訂單</button>
          </div>

          <div id="result"></div>
        </div>

      </div>

    </form>
    </div>

  <!-- 圖片放大模態框 -->
  <div class="modal" id="imageModal">
    <img 
      src="" 
      alt=""
      class="modal-content"
      id="modalImage"
    />
  </div>

  <script>
    // === 價格設定 ===
    const PRICE = {
      main: 150,
      side: 30
    };

    // === 商品項目（含圖片） ===
    const MAIN_ITEMS = [
      { name: "鹽水半雞", img: "https://images.unsplash.com/photo-1598103442097-8b74394b95c6?w=400&h=400&fit=crop&q=80" },
      { name: "煙燻半雞", img: "https://images.unsplash.com/photo-1594221708779-94832f4320d1?w=400&h=400&fit=crop&q=80" },
      { name: "油雞腿", img: "https://images.unsplash.com/photo-1604503468506-a8da13d82791?w=400&h=400&fit=crop&q=80" },
      { name: "油雞胸", img: "https://images.unsplash.com/photo-1633237308525-cd587cf71926?w=400&h=400&fit=crop&q=80" }
    ];
    
    // 庫存狀態（從後端動態載入）
    let INVENTORY = {};
    
    const SIDE_ITEMS = {
      "葉菜類": [
        { name: "花椰菜" },
        { name: "龍鬚菜" },
        { name: "高麗菜" },
        { name: "娃娃菜" }
      ],
      "瓜類": [
        { name: "綠苦瓜" },
        { name: "小黃瓜" }
      ],
      "菇類": [
        { name: "金針菇" },
        { name: "杏鮑菇" },
        { name: "鮮香菇" },
        { name: "黑木耳" }
      ],
      "根莖類": [
        { name: "玉米筍" },
        { name: "筍白筍" },
        { name: "白蘿蔔" },
        { name: "紅蘿蔔" },
        { name: "洋蔥" },
        { name: "蓮藕" },
        { name: "脆筍片" }
      ],
      "豆製品": [
        { name: "豆皮" },
        { name: "百頁豆腐" },
        { name: "小豆干" }
      ],
      "其他": [
        { name: "四季豆" },
        { name: "海帶根" },
        { name: "皮蛋" },
        { name: "鵪鶉蛋" },
        { name: "雞皮" },
        { name: "雞冠" },
        { name: "雞蛋黃" },
        { name: "雞蛋腸" }
      ]
    };

    // Google Apps Script URL
    const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbyMCIfVwJpnbMAnjAh-FKBxxc8jONLyCiib86RR6IPgWUcqth0KmSc0I82CKOKkZb0m/exec";

    // ====== 載入庫存狀態 ======
    async function loadInventory() {
      try {
        const res = await fetch(`${GAS_ENDPOINT}?action=getInventory`);
        const data = await res.json();
        
        if (data.ok) {
          INVENTORY = data.inventory;
          console.log('庫存已載入:', INVENTORY);
          
          // 更新商品卡片的缺貨狀態
          updateStockStatus();
        }
      } catch (err) {
        console.warn('無法載入庫存，使用預設設定:', err);
        // 如果無法連線，仍允許訂購（降級處理）
      }
    }

    // ====== 更新商品的缺貨狀態 ======
    function updateStockStatus() {
      // 更新主餐的缺貨狀態
      document.querySelectorAll('#mains .product-card').forEach(card => {
        const input = card.querySelector('input.qty');
        const itemName = input?.dataset.name;
        
        if (itemName && INVENTORY[itemName]) {
          const stock = INVENTORY[itemName];
          
          if (!stock.available || stock.stock <= 0) {
            // 標記為缺貨
            card.classList.add('out-of-stock');
            
            // 禁用輸入和按鈕
            card.querySelectorAll('input, button, select').forEach(el => {
              el.disabled = true;
            });
            
            // 添加缺貨標籤（如果還沒有）
            if (!card.querySelector('.out-of-stock-badge')) {
              const badge = document.createElement('div');
              badge.className = 'out-of-stock-badge';
              badge.textContent = '缺貨中';
              card.insertBefore(badge, card.firstChild);
            }
          } else {
            // 移除缺貨標記
            card.classList.remove('out-of-stock');
            card.querySelectorAll('input, button, select').forEach(el => {
              el.disabled = false;
            });
            const badge = card.querySelector('.out-of-stock-badge');
            if (badge) badge.remove();
          }
        }
      });
      
      // 更新單點配菜的缺貨狀態
      document.querySelectorAll('#sides .side-item').forEach(item => {
        const input = item.querySelector('input.qty');
        const itemName = input?.dataset.name;
        
        if (itemName && INVENTORY[itemName]) {
          const stock = INVENTORY[itemName];
          
          if (!stock.available || stock.stock <= 0) {
            item.style.opacity = '0.5';
            item.querySelectorAll('input, button').forEach(el => {
              el.disabled = true;
            });
            
            // 添加缺貨提示
            if (!item.querySelector('.stock-badge')) {
              const badge = document.createElement('span');
              badge.className = 'stock-badge';
              badge.style.cssText = 'color: var(--danger); font-size: 10px; margin-left: 4px;';
              badge.textContent = '(缺貨)';
              item.querySelector('.side-item-name').appendChild(badge);
            }
          }
        }
      });
    }

    // ====== 產生商品卡片（多欄網格 + 圖片） ======
    const mainsBox = document.querySelector('#mains');
    MAIN_ITEMS.forEach(item => {
      const card = document.createElement('div');
      card.className = item.outOfStock ? 'product-card out-of-stock' : 'product-card';
      card.innerHTML = `
        ${item.outOfStock ? '<div class="out-of-stock-badge">缺貨中</div>' : ''}
        <div class="product-image-wrap" data-image="${item.img.replace('w=400&h=400', 'w=800&h=800')}" data-name="${item.name}">
          <img src="${item.img}" alt="${item.name}" class="product-image" loading="lazy" />
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:clamp(5px,1.2vw,6px);">
          <div class="product-name" style="margin-bottom:0;">${item.name}</div>
          <div class="product-price" style="margin-bottom:0;">$${PRICE.main}</div>
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:clamp(4px,1vw,6px);">
          <div class="qty-control">
            <button type="button" class="qty-btn" data-action="decrease" data-target="${item.name}" ${item.outOfStock ? 'disabled' : ''}>−</button>
            <input 
              type="number" 
              min="0" 
              max="99"
              value="0" 
              data-type="main" 
              data-name="${item.name}" 
              class="qty"
              ${item.outOfStock ? 'disabled' : ''}
            />
            <button type="button" class="qty-btn" data-action="increase" data-target="${item.name}" ${item.outOfStock ? 'disabled' : ''}>+</button>
          </div>
          <select data-cut="${item.name}" style="width:100%; font-size:clamp(11px,2.5vw,12px);" ${item.outOfStock ? 'disabled' : ''}>
            <option>去骨</option>
            <option>保留骨頭</option>
          </select>
        </div>
      `;
      mainsBox.appendChild(card);
    });

    const sidesBox = document.querySelector('#sides');
    
    // 依分類生成單點配菜（可摺疊）
    Object.keys(SIDE_ITEMS).forEach((category, index) => {
      // 分類區塊容器
      const categoryBlock = document.createElement('div');
      categoryBlock.className = 'category-block';
      
      // 分類標題
      const categoryTitle = document.createElement('div');
      categoryTitle.className = 'category-title';
      categoryTitle.innerHTML = `
        <span>${category} <small style="opacity:0.7">(${SIDE_ITEMS[category].length}項)</small></span>
        <span class="toggle-icon">▼</span>
      `;
      categoryBlock.appendChild(categoryTitle);
      
      // 分類內容
      const categoryContent = document.createElement('div');
      categoryContent.className = 'category-content';
      // 所有分類預設收合
      
      // 該分類的品項
      SIDE_ITEMS[category].forEach(item => {
        const sideItem = document.createElement('div');
        sideItem.className = 'side-item';
        sideItem.innerHTML = `
          <div class="side-item-name">${item.name}</div>
          <div class="qty-control">
            <button type="button" class="qty-btn" data-action="decrease" data-target="${item.name}">−</button>
            <input 
              type="number" 
              min="0" 
              max="99"
              value="0" 
              data-type="side" 
              data-name="${item.name}" 
              class="qty"
            />
            <button type="button" class="qty-btn" data-action="increase" data-target="${item.name}">+</button>
          </div>
        `;
        categoryContent.appendChild(sideItem);
      });
      
      categoryBlock.appendChild(categoryContent);
      sidesBox.appendChild(categoryBlock);
      
      // 點擊標題切換展開/收合
      categoryTitle.addEventListener('click', () => {
        categoryTitle.classList.toggle('active');
        categoryContent.classList.toggle('active');
      });
    });

    // ====== 圖片點擊放大功能 ======
    const imageModal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    
    // 品牌 Logo 點擊放大
    const brandLogo = document.getElementById('brandLogo');
    brandLogo.addEventListener('click', () => {
      modalImage.src = "https://images.unsplash.com/photo-1598103442097-8b74394b95c6?w=800&h=800&fit=crop&q=80";
      modalImage.alt = "極品鹽水雞";
      imageModal.classList.add('active');
    });
    
    // 商品圖片點擊放大（事件委派）
    document.addEventListener('click', (e) => {
      const menuImageWrap = e.target.closest('.menu-image-wrap');
      const imageWrap = e.target.closest('.product-image-wrap');
      
      if (menuImageWrap) {
        // 菜單圖片點擊放大
        const largeImage = menuImageWrap.dataset.image;
        const name = menuImageWrap.dataset.name;
        modalImage.src = largeImage;
        modalImage.alt = name;
        imageModal.classList.add('active');
      } else if (imageWrap) {
        const largeImage = imageWrap.dataset.image;
        const name = imageWrap.dataset.name;
        modalImage.src = largeImage;
        modalImage.alt = name;
        imageModal.classList.add('active');
      }
    });
    
    // 點擊模態框關閉
    imageModal.addEventListener('click', () => {
      imageModal.classList.remove('active');
    });

    // ====== 取餐時間組合 ======
    const etaHour = document.getElementById('etaHour');
    const etaMinute = document.getElementById('etaMinute');
    const etaCombined = document.getElementById('etaCombined');
    
    function updateEta() {
      const hour = etaHour.value;
      const minute = etaMinute.value;
      if (hour && minute) {
        etaCombined.value = `${hour}:${minute}`;
      } else {
        etaCombined.value = '';
      }
    }
    
    etaHour.addEventListener('change', updateEta);
    etaMinute.addEventListener('change', updateEta);

    // ====== 數量增減按鈕事件 ======
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.qty-btn');
      if (!btn) return;
      
      const action = btn.dataset.action;
      const targetName = btn.dataset.target;
      const input = document.querySelector(`input[data-name="${targetName}"]`);
      
      if (!input) return;
      
      let currentValue = parseInt(input.value) || 0;
      
      if (action === 'increase' && currentValue < 99) {
        currentValue++;
      } else if (action === 'decrease' && currentValue > 0) {
        currentValue--;
      }
      
      input.value = currentValue;
      input.setAttribute('value', currentValue);
      
      // 觸發計算
      recalc();
    });

    // ====== 即時計算與預覽 ======
    const qtyInputs = document.querySelectorAll('.qty');
    const previewEl = document.querySelector('#preview');
    const totalEl = document.querySelector('#totalAmt');
    const form = document.querySelector('#orderForm');
    const result = document.querySelector('#result');

    qtyInputs.forEach(input => {
      input.addEventListener('input', recalc);
      // 更新 value 屬性以便 CSS :has() 選擇器生效
      input.addEventListener('input', function() {
        this.setAttribute('value', this.value);
      });
    });

    function recalc() {
      let items = [];
      let total = 0;

      qtyInputs.forEach(q => {
        const n = parseInt(q.value || '0', 10);
        if (n > 0) {
          const name = q.dataset.name;
          const kind = q.dataset.type;
          const price = (kind === 'main') ? PRICE.main : PRICE.side;
          total += n * price;
          items.push({name, qty: n, price, subtotal: n * price});
        }
      });

      if (items.length === 0) {
        previewEl.innerHTML = '<div class="preview-empty">尚未選擇商品</div>';
      } else {
        previewEl.innerHTML = items.map(item => `
          <div class="preview-item">
            <strong>${item.name}</strong> × ${item.qty} 
            <span style="float:right;color:var(--primary)">$${item.subtotal}</span>
          </div>
        `).join('');
      }

      totalEl.textContent = `$${total}`;
      return {items, total};
    }

    recalc();

    // ====== 頁面載入時初始化 ======
    window.addEventListener('DOMContentLoaded', () => {
      // 載入庫存狀態
      loadInventory();
    });

    // ====== 清空按鈕 ======
    document.querySelector('#resetBtn').addEventListener('click', () => {
      if (confirm('確定要清空所有選項嗎？')) {
        form.reset();
        // 重置時間選擇
        etaHour.value = '';
        etaMinute.value = '';
        etaCombined.value = '';
        
        // 重置數量輸入
        qtyInputs.forEach(q => {
          q.value = 0;
          q.setAttribute('value', '0');
        });
        recalc();
        result.innerHTML = '';
      }
    });

    // ====== 表單送出 ======
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const {items, total} = recalc();
      
      // 驗證時間
      if (!etaCombined.value) {
        result.innerHTML = '<div class="message error">⚠️ 請選擇取餐時間</div>';
        return;
      }
      
      if (items.length === 0) {
        result.innerHTML = '<div class="message error">⚠️ 請至少選擇 1 項商品</div>';
        return;
      }

      // 收集口味選項
      const tasteOptions = {
        辣度: form.spicy.value,
        鹹度: form.saltiness.value,
        檸檬: form.lemon.value,
        蔥泥: form.scallion.value
      };

      // 收集去骨選項
      const cuts = {};
      document.querySelectorAll('select[data-cut]').forEach(s => {
        const qty = document.querySelector(`input[data-name="${s.dataset.cut}"]`).value;
        if (parseInt(qty) > 0) {
        cuts[s.dataset.cut] = s.value;
        }
      });

      const itemsDetail = items.map(it => `${it.name} x${it.qty}`).join(' / ');
      
      // 格式化口味和去骨选项为字符串（簡化格式）
      const tasteStr = Object.entries(tasteOptions).map(([k, v]) => v).join('、');
      const cutStr = Object.entries(cuts).map(([k, v]) => `${k}:${v}`).join(', ');

      // 生成格式化訂單摘要（用於顯示和儲存）
      const nameParts = form.name.value.trim().split(/[\s\#]/);
      const mainName = nameParts[0] || '';
      const phone = form.phone.value.trim();
      const last3Digits = phone.slice(-3);
      const [hour, minute] = etaCombined.value.split(':');
      const timeStr = `${hour}點${minute}分`;
      
      // 格式化餐點（每行3個）
      const itemLines = [];
      for (let i = 0; i < items.length; i += 3) {
        const lineItems = items.slice(i, i + 3).map(it => `${it.name} x${it.qty}`).join(' / ');
        itemLines.push(lineItems);
      }
      const itemsText = itemLines.join('\n');
      
      // 格式化調味
      const tasteText = Object.entries(tasteOptions).map(([k, v]) => `${k}：${v}`).join('\n');
      
      // 組合訂單摘要
      const orderSummary = `① 姓名.後三碼：${mainName}.${last3Digits}
② 想預訂的時間：${timeStr}
③ 想預訂的餐點：
${itemsText}
④ 想搭配的調味：
${tasteText}
金額：${total}`;

      const payload = {
        ts: new Date().toISOString(),
        name: form.name.value.trim(),
        phone: form.phone.value.trim(),
        method: form.method.value,
        eta: etaCombined.value,
        itemsDetail,
        total,
        taste: tasteStr,
        cut: cutStr,
        note: form.note.value.trim(),
        orderSummary: orderSummary,
        source: 'web'
      };

      try {
        result.innerHTML = '<div class="message">⏳ 送出中，請稍候...</div>';
        
        // 使用 FormData 格式（Google Apps Script 更相容）
        const formData = new FormData();
        Object.keys(payload).forEach(key => {
          formData.append(key, payload[key]);
        });
        
        const res = await fetch(GAS_ENDPOINT, {
          method: 'POST',
          body: formData
        });
        
        const data = await res.json();
        
        if (data.ok) {
          // 使用已生成的 orderSummary
          result.innerHTML = `
            <div class="message success">
              ✅ 訂單已送出！<br/>
              <strong>訂單編號：${data.orderNo}</strong><br/>
              <small>請準時於今日 ${etaCombined.value} 取餐</small>
            </div>
            <div style="
              margin-top: 12px;
              padding: 14px;
              background: #f9fafb;
              border: 1.5px solid var(--border);
              border-radius: clamp(8px, 2vw, 10px);
              font-size: clamp(12px, 3vw, 13px);
              line-height: 1.8;
              white-space: pre-line;
              font-family: monospace;
              position: relative;
            ">
              <div style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 12px;
                padding-bottom: 8px;
                border-bottom: 1px solid var(--border);
              ">
                <span style="
                  font-weight: 600;
                  color: var(--text);
                  font-size: clamp(13px, 3.2vw, 14px);
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                ">您此次的訂單如下</span>
                <button 
                  type="button"
                  onclick="navigator.clipboard.writeText(this.parentElement.nextElementSibling.textContent); this.textContent='✓ 已複製'; setTimeout(()=>this.textContent='📋 複製訂單', 2000)"
                  style="
                    padding: 4px 10px;
                    background: var(--primary);
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: clamp(10px, 2.5vw, 11px);
                    cursor: pointer;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    white-space: nowrap;
                  "
                >📋 複製訂單</button>
              </div>
              <div>${orderSummary}</div>
            </div>
          `;
          // 可選：自動滾動到訊息位置
          result.scrollIntoView({behavior: 'smooth', block: 'center'});
        } else {
          result.innerHTML = `<div class="message error">❌ 送出失敗：${data.msg || '未知錯誤'}</div>`;
        }
      } catch (err) {
        console.error('詳細錯誤:', err);
        result.innerHTML = `<div class="message error">❌ 連線失敗：${err.message}<br/><small>請檢查網路或聯繫管理員</small></div>`;
      }
    });
  </script>
</body>
</html>
